<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django 环境搭建</title>
    <style type="text/css" media="all">
      body {
        margin: 0;
        font-family: "Helvetica Neue", Helvetica, Arial, "Hiragino Sans GB", sans-serif;
        font-size: 14px;
        line-height: 20px;
        color: #777;
        background-color: white;
      }
      .container {
        width: 700px;
        margin-right: auto;
        margin-left: auto;
      }

      .post {
        font-family: Georgia, "Times New Roman", Times, "SimSun", serif;
        position: relative;
        padding: 70px;
        bottom: 0;
        overflow-y: auto;
        font-size: 16px;
        font-weight: normal;
        line-height: 25px;
        color: #515151;
      }

      .post h1{
        font-size: 50px;
        font-weight: 500;
        line-height: 60px;
        margin-bottom: 40px;
        color: inherit;
      }

      .post p {
        margin: 0 0 35px 0;
      }

      .post img {
        border: 1px solid #D9D9D9;
      }

      .post a {
        color: #28A1C5;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="post">
        <h1 class="title">Django 环境搭建</h1>
        <div class="show-content">
          <h2>安装 Django</h2><p>先安装 PIP，再通过 PIP 安装 Django</p><p>安装 PIP</p><p>cd /data;</p><p>mkdir tmp;</p><p>cd tmp;</p><p>wget https://bootstrap.pypa.io/get-pip.py;</p><p>python ./get-pip.py;</p><p>使用 PIP，安装 Django</p><p>pip install Django==1.11.7</p><h2>安装 Mysql</h2><p>安装并启动 mariadb</p><p>因为 CentOS 7 之后的版本都不在提供 Mysql 安装源，这里我们使用 mariadb 代替 mysql，依次执行下列命令</p><p>yum install mariadb mariadb-server -y</p><p>yum install MySQL-python -y</p><p>systemctl start mariadb</p><p>对 mariadb 进行初始化设置</p><p>执行下面命令，根据提示操作</p><p>设置新密码为 test</p><p>默认密码为空，直接回车即可</p><p>mysql_secure_installation</p><p>使用设置的密码登陆 mariadb</p><p>登陆 db，这里假设密码被设置为 test</p><p>mysql -uroot -ptest</p><p>创建一个数据库</p><p>create database mysite;</p><p>成功后，输入 exit 命令退出 db</p><p>exit</p><h2>创建 Django 项目</h2><p>创建 mysite 项目</p><p>在 /data/ 目录下，创建一个名为 mysite 的 Django 项目</p><p>cd /data/</p><p>django-admin startproject mysite</p><p>修改配置文件，与 Mysql 数据库相关联</p><p>备注：SECRET_KEY 配置项无需修改</p><p><i>编辑 /data/mysite/mysite/settings.py</i></p><p>示例代码：/data/mysite/mysite/settings.py</p><p>"""</p><p>Django settings for mysite project.</p><p>Generated by 'django-admin startproject' using Django 1.11.7.</p><p>For more information on this file, see</p><p>https://docs.djangoproject.com/en/1.11/topics/settings/</p><p>For the full list of settings and their values, see</p><p>https://docs.djangoproject.com/en/1.11/ref/settings/</p><p>"""</p><p>import os</p><p># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</p><p>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</p><p># Quick-start development settings - unsuitable for production</p><p># See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/</p><p># SECURITY WARNING: keep the secret key used in production secret!</p><p>SECRET_KEY = 'm4@g1=hz^08y(9d)v5l!8^*0wbla=oe15s@u8@5^pw=llfz48%'</p><p># SECURITY WARNING: don't run with debug turned on in production!</p><p>DEBUG = True</p><p>ALLOWED_HOSTS = ["*"]</p><p># Application definition</p><p>INSTALLED_APPS = [</p><p>    'django.contrib.admin',</p><p>    'django.contrib.auth',</p><p>    'django.contrib.contenttypes',</p><p>    'django.contrib.sessions',</p><p>    'django.contrib.messages',</p><p>    'django.contrib.staticfiles',</p><p>]</p><p>MIDDLEWARE = [</p><p>    'django.middleware.security.SecurityMiddleware',</p><p>    'django.contrib.sessions.middleware.SessionMiddleware',</p><p>    'django.middleware.common.CommonMiddleware',</p><p>    'django.middleware.csrf.CsrfViewMiddleware',</p><p>    'django.contrib.auth.middleware.AuthenticationMiddleware',</p><p>    'django.contrib.messages.middleware.MessageMiddleware',</p><p>    'django.middleware.clickjacking.XFrameOptionsMiddleware',</p><p>]</p><p>ROOT_URLCONF = 'mysite.urls'</p><p>TEMPLATES = [</p><p>    {</p><p>        'BACKEND': 'django.template.backends.django.DjangoTemplates',</p><p>        'DIRS': [],</p><p>        'APP_DIRS': True,</p><p>        'OPTIONS': {</p><p>            'context_processors': [</p><p>                'django.template.context_processors.debug',</p><p>                'django.template.context_processors.request',</p><p>                'django.contrib.auth.context_processors.auth',</p><p>                'django.contrib.messages.context_processors.messages',</p><p>            ],</p><p>        },</p><p>    },</p><p>]</p><p>WSGI_APPLICATION = 'mysite.wsgi.application'</p><p># Database</p><p># https://docs.djangoproject.com/en/1.11/ref/settings/#databases</p><p>DATABASES = {</p><p>    'default': {</p><p>        'ENGINE': 'django.db.backends.mysql',</p><p>        'NAME': 'mysite',</p><p>        'PASSWORD':'test',</p><p>        'USER': 'root',</p><p>        'HOST':'127.0.0.1',</p><p>        'PORT':'3306',</p><p>    }</p><p>}</p><p># Password validation</p><p># https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators</p><p>AUTH_PASSWORD_VALIDATORS = [</p><p>    {</p><p>        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',</p><p>    },</p><p>    {</p><p>        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',</p><p>    },</p><p>    {</p><p>        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',</p><p>    },</p><p>    {</p><p>        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',</p><p>    },</p><p>]</p><p># Internationalization</p><p># https://docs.djangoproject.com/en/1.11/topics/i18n/</p><p>LANGUAGE_CODE = 'en-us'</p><p>TIME_ZONE = 'UTC'</p><p>USE_I18N = True</p><p>USE_L10N = True</p><p>USE_TZ = True</p><p># Static files (CSS, JavaScript, Images)</p><p># https://docs.djangoproject.com/en/1.11/howto/static-files/</p><p>STATIC_URL = '/static/'</p><p>创建 Django 数据库</p><p>cd /data/mysite</p><p>python manage.py migrate</p><p>启动 Django</p><p>python manage.py runserver</p><p>如果没有报错，就说明 Django 已经安装成功了，并且跟 Mysql 的连接正常</p><p>退出 Django</p><p>按 ctrl+c 退出 Django 服务</p><h2>安装 Nginx</h2><p>通过 yum 安装 Nginx</p><p>yum install nginx -y</p><p>启动 Nginx 服务</p><p>systemctl start nginx</p><p>访问下面的链接，可以看到 nginx 的欢迎界面</p><p>http://&lt;您的 CVM IP 地址&gt;/</p><p>安装 uwsgi</p><p>任务时间：5min ~ 10min</p><p>使用 yum 命令安装 uwsgi</p><p>yum install uwsgi uwsgi-plugin-python -y</p><h2>让 Nginx，uwsgi，Django 协同工作</h2><p>修改 Nginx 配置文件</p><p><i>编辑 /etc/nginx/nginx.conf</i></p><p>示例代码：/etc/nginx/nginx.conf</p><p># For more information on configuration, see:</p><p>#   * Official English Documentation: http://nginx.org/en/docs/</p><p>#   * Official Russian Documentation: http://nginx.org/ru/docs/</p><p>user nginx;</p><p>worker_processes auto;</p><p>error_log /var/log/nginx/error.log;</p><p>pid /run/nginx.pid;</p><p># Load dynamic modules. See /usr/share/nginx/README.dynamic.</p><p>include /usr/share/nginx/modules/*.conf;</p><p>events {</p><p>    worker_connections 1024;</p><p>}</p><p>http {</p><p>    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</p><p>                      '$status $body_bytes_sent "$http_referer" '</p><p>                      '"$http_user_agent" "$http_x_forwarded_for"';</p><p>    access_log  /var/log/nginx/access.log  main;</p><p>    sendfile            on;</p><p>    tcp_nopush          on;</p><p>    tcp_nodelay         on;</p><p>    keepalive_timeout   65;</p><p>    types_hash_max_size 2048;</p><p>    include             /etc/nginx/mime.types;</p><p>    default_type        application/octet-stream;</p><p>    # Load modular configuration files from the /etc/nginx/conf.d directory.</p><p>    # See http://nginx.org/en/docs/ngx_core_module.html#include</p><p>    # for more information.</p><p>    include /etc/nginx/conf.d/*.conf;</p><p>    server {</p><p>        listen       80 default_server;</p><p>        listen       [::]:80 default_server;</p><p>        server_name  _;</p><p>        root         /usr/share/nginx/html;</p><p>        # Load configuration files for the default server block.</p><p>        include /etc/nginx/default.d/*.conf;</p><p>        location / {</p><p>            include uwsgi_params;</p><p>            uwsgi_pass 127.0.0.1:8000;</p><p>        }</p><p>        error_page 404 /404.html;</p><p>            location = /40x.html {</p><p>        }</p><p>        error_page 500 502 503 504 /50x.html;</p><p>            location = /50x.html {</p><p>        }</p><p>    }</p><p># Settings for a TLS enabled server.</p><p>#</p><p>#    server {</p><p>#        listen       443 ssl http2 default_server;</p><p>#        listen       [::]:443 ssl http2 default_server;</p><p>#        server_name  _;</p><p>#        root         /usr/share/nginx/html;</p><p>#</p><p>#        ssl_certificate "/etc/pki/nginx/server.crt";</p><p>#        ssl_certificate_key "/etc/pki/nginx/private/server.key";</p><p>#        ssl_session_cache shared:SSL:1m;</p><p>#        ssl_session_timeout  10m;</p><p>#        ssl_ciphers HIGH:!aNULL:!MD5;</p><p>#        ssl_prefer_server_ciphers on;</p><p>#</p><p>#        # Load configuration files for the default server block.</p><p>#        include /etc/nginx/default.d/*.conf;</p><p>#</p><p>#        location / {</p><p>#        }</p><p>#</p><p>#        error_page 404 /404.html;</p><p>#            location = /40x.html {</p><p>#        }</p><p>#</p><p>#        error_page 500 502 503 504 /50x.html;</p><p>#            location = /50x.html {</p><p>#        }</p><p>#    }</p><p>}</p><p>重启 Nginx</p><p>/usr/sbin/nginx -s reload</p><p>创建 uwsgi 配置文件</p><p>请在 /data/mysite 目录下<i>创建 uwsgi.ini</i>，参考下面的内容。</p><p>示例代码：/data/mysite/uwsgi.ini</p><p>[uwsgi]</p><p>socket = 127.0.0.1:8000</p><p>chdir = /data/mysite</p><p>wsgi-file = mysite/wsgi.py</p><p>processes = 4</p><p>threads = 2</p><p>stats = 127.0.0.1:9191</p><p>uid = nobody</p><p>gid = nobody</p><p>master = true</p><p>harakiri = 30</p><p>daemonize = /data/mysite/uwsgi.log</p><p>plugins = python</p><p>启动 uwsgi</p><p>uwsgi uwsgi.ini</p><p>测试</p><p>访问链接 http://&lt;您的  IP 地址&gt;/ </p><p>如果可以看到 Django 的界面，恭喜你，环境搭建成功</p>
        </div>
      </div>
    </div>
  </body>
</html>
